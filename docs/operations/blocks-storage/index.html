<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.59.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Blocks storage (experimental) | Cortex</title><meta property="og:title" content="Blocks storage (experimental)"><meta property="og:description" content="The blocks storage is an experimental Cortex storage engine based on Prometheus TSDB: it stores each tenant&rsquo;s time series into their own TSDB which write out their series to a on-disk Block (defaults to 2h block range periods). Each Block is composed by chunk files - containing the timestamp-value pairs for multiple series - and an index, which indexes metric names and labels to time series in the chunk files."><meta property="og:type" content="article"><meta property="og:url" content="/docs/operations/blocks-storage/"><meta property="og:image" content="/images/logo-twitter-card.jpg"><meta property="og:site_name" content="Cortex"><meta itemprop=name content="Blocks storage (experimental)"><meta itemprop=description content="The blocks storage is an experimental Cortex storage engine based on Prometheus TSDB: it stores each tenant&rsquo;s time series into their own TSDB which write out their series to a on-disk Block (defaults to 2h block range periods). Each Block is composed by chunk files - containing the timestamp-value pairs for multiple series - and an index, which indexes metric names and labels to time series in the chunk files."><meta itemprop=wordCount content="2324"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/logo-twitter-card.jpg"><meta name=twitter:title content="Blocks storage (experimental)"><meta name=twitter:description content="The blocks storage is an experimental Cortex storage engine based on Prometheus TSDB: it stores each tenant&rsquo;s time series into their own TSDB which write out their series to a on-disk Block (defaults to 2h block range periods). Each Block is composed by chunk files - containing the timestamp-value pairs for multiple series - and an index, which indexes metric names and labels to time series in the chunk files."><link rel=preload href=/scss/main.min.4ff813ae4617e8aa437e422dee0b5f0d0d29f44049ee9dc629d104243b05d88b.css as=style><link href=/scss/main.min.4ff813ae4617e8aa437e422dee0b5f0d0d29f44049ee9dc629d104243b05d88b.css rel=stylesheet integrity><link href=/css/offline-search.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.1.6/lunr.js></script><script src=/js/offline-search.js></script><title>Blocks storage (experimental) | Cortex</title></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar navbar-nocover"><a id=cortex-logo class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-17.92 -14.92 1191.84 462.84"><defs><style>.cls-1{fill:#fff}</style></defs><path d="M214.531 8.017C99.353 8.017 5.65 101.72 5.65 216.899S99.353 425.78 214.531 425.78s208.882-93.704 208.882-208.882S329.71 8.017 214.531 8.017zm0 408.558c-110.102.0-199.676-89.574-199.676-199.676S104.429 17.222 214.53 17.222 414.208 106.797 414.208 216.9 324.633 416.575 214.53 416.575z" class="cls-1"/><circle cx="327.452" cy="221.633" r="34.571" class="cls-1"/><circle cx="213.713" cy="353.584" r="34.571" class="cls-1"/><path d="M299.992 167.913l-59-56.05a34.578 34.578.0 1 0-4.343 4.34l57.828 54.937a60.158 60.158.0 0 0-27.168 49.123h-12.97l-23.456-67.02-26.055 64.718H175.73l-24.724 57.22-21.808-54.524-.063.025v-.586h-22.048a34.582 34.582.0 1 0-.275 6.138h18.005l25.97 64.925 28.977-67.06h29.207l21.51-53.424 19.503 55.725H267.5a60.173 60.173.0 0 0 25.202 44.11l-56.52 56.52 4.34 4.338 57.492-57.492a60.155 60.155.0 1 0 1.977-105.963zm81.481 53.515a54.02 54.02.0 1 1-54.022-54.02 54.083 54.083.0 0 1 54.022 54.02zm175.707 42.568q-8.797 8.178-24.405 8.177a34.858 34.858.0 0 1-17.095-3.965 33.188 33.188.0 0 1-11.643-10.529 46.374 46.374.0 0 1-6.566-14.99 71.134 71.134.0 0 1-2.105-17.341 86.99 86.99.0 0 1 1.982-18.706 46.804 46.804.0 0 1 6.565-15.98 34.028 34.028.0 0 1 12.263-11.149q7.675-4.21 19.077-4.212 13.38.0 21.306 6.69 7.927 6.689 10.405 18.829h21.803a50.76 50.76.0 0 0-5.946-19.696 44.06 44.06.0 0 0-12.015-13.75 49.842 49.842.0 0 0-16.848-8.051 77.44 77.44.0 0 0-20.44-2.601q-15.114.0-26.509 5.326a52.935 52.935.0 0 0-18.952 14.617 62.165 62.165.0 0 0-11.273 21.8 94.013 94.013.0 0 0-3.717 26.883 86.195 86.195.0 0 0 3.84 26.386 57.783 57.783.0 0 0 11.397 20.686 50.138 50.138.0 0 0 18.829 13.38 66.766 66.766.0 0 0 25.891 4.705q24.527.0 38.772-12.882 14.245-12.878 17.715-36.668h-21.556q-1.986 14.867-10.776 23.041zm157.44-87.828a56.338 56.338.0 0 0-19.447-14.244q-11.52-5.203-26.882-5.203-15.115.0-26.756 5.203a56.009 56.009.0 0 0-19.573 14.244 59.75 59.75.0 0 0-11.892 21.307 85.299 85.299.0 0 0-3.965 26.386 84.117 84.117.0 0 0 3.965 26.262 59.853 59.853.0 0 0 11.892 21.183 54.61 54.61.0 0 0 19.573 14.12q11.643 5.077 26.756 5.08 15.36.0 26.882-5.08a54.908 54.908.0 0 0 19.447-14.12 59.95 59.95.0 0 0 11.892-21.183 84.181 84.181.0 0 0 3.965-26.262 85.364 85.364.0 0 0-3.965-26.386 59.846 59.846.0 0 0-11.892-21.307zm-9.538 68.38a43.305 43.305.0 0 1-8.548 15.113 37.061 37.061.0 0 1-12.759 9.29 38.825 38.825.0 0 1-30.968.0 37.003 37.003.0 0 1-12.76-9.29 43.209 43.209.0 0 1-8.547-15.114 70.669 70.669.0 0 1 0-41.373 44.634 44.634.0 0 1 8.547-15.237 36.428 36.428.0 0 1 12.76-9.415 38.826 38.826.0 0 1 30.968.0 36.484 36.484.0 0 1 12.76 9.415 44.735 44.735.0 0 1 8.547 15.237 70.624 70.624.0 0 1 0 41.373zm81.141-80.89q-11.147 7.434-18.83 23.041h-.493v-27.005h-19.82V287.78h21.057v-56.984a87.528 87.528.0 0 1 2.478-21.924 41.993 41.993.0 0 1 7.93-16.228 33.951 33.951.0 0 1 14.368-10.158q8.919-3.468 21.555-3.468V156.72q-17.097-.493-28.245 6.937zm80.761-42.366h-21.06v38.402h-21.8v18.581h21.8v81.51a48.668 48.668.0 0 0 1.734 14.37 17.432 17.432.0 0 0 5.326 8.423 20.57 20.57.0 0 0 9.415 4.088 75.59 75.59.0 0 0 13.999 1.115h16.104v-18.582h-9.664a70.335 70.335.0 0 1-8.05-.37 10.361 10.361.0 0 1-4.833-1.611 6.108 6.108.0 0 1-2.354-3.469 23.006 23.006.0 0 1-.617-5.946v-79.528h25.518v-18.581h-25.518zm148.522 60.452a56.135 56.135.0 0 0-18.085-17.962q-11.276-7.063-28.367-7.06a58.263 58.263.0 0 0-24.155 4.953 56.796 56.796.0 0 0-19.079 13.875 63.949 63.949.0 0 0-12.51 21.058 77.064 77.064.0 0 0-4.461 26.758 102.521 102.521.0 0 0 4.338 27.004 58.87 58.87.0 0 0 11.519 21.307 52.43 52.43.0 0 0 18.953 13.873q11.272 4.954 26.632 4.955 21.8.0 36.173-10.901 14.364-10.898 18.58-32.455h-20.81q-2.73 12.635-11.272 18.829-8.549 6.198-21.927 6.195a43.577 43.577.0 0 1-18.085-3.468 35.417 35.417.0 0 1-12.636-9.291 36.127 36.127.0 0 1-7.184-13.38 50.746 50.746.0 0 1-1.981-15.98h95.879a102.07 102.07.0 0 0-2.107-24.526 71.064 71.064.0 0 0-9.415-23.784zm-84.357 29.73a43.81 43.81.0 0 1 3.219-13.999 37.354 37.354.0 0 1 7.433-11.52 34.013 34.013.0 0 1 11.272-7.803 36.694 36.694.0 0 1 14.74-2.85 36.062 36.062.0 0 1 14.494 2.85 36.492 36.492.0 0 1 11.398 7.68 36.107 36.107.0 0 1 7.68 11.52 43.253 43.253.0 0 1 3.345 14.122zm170.95 7.184 44.1-58.964h-25.271l-31.961 44.843-30.721-44.843h-27.006l44.595 60.698-48.063 67.389h25.518l35.677-53.019 35.676 53.019h27.006l-49.55-69.123z" class="cls-1"/></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://twitter.com/cortexmetrics class="nav-link active"><span class=active><i class="fab fa-fw fa-twitter"></i>Twitter</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://github.com/cortexproject class="nav-link active"><span class=active><i class="fab fa-fw fa-github"></i>Github</span></a></li></ul></div><div class="navbar-nav d-none d-md-block"><div id=search-nav-container><input type=search id=search-input autocomplete=off class="form-control td-search-input" placeholder="&#xf002 Search this siteâ€¦" autocomplete=on><div id=search-results class=container></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=docs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/getting-started/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class=collapse id=docs-getting-started><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-getting-started-getting-started-chunks-storage href=/docs/getting-started/getting-started-chunks-storage/>Chunks Storage</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-getting-started-getting-started-blocks-storage href=/docs/getting-started/getting-started-blocks-storage/>Blocks Storage (experimental)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-getting-started-getting-started-with-gossiped-ring href=/docs/getting-started/getting-started-with-gossiped-ring/>Gossip Ring (experimental)</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-architecture href=/docs/architecture/>Architecture</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-apis href=/docs/apis/>Cortex APIs</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/guides/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Guides</a></li><ul><li class=collapse id=docs-guides><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-running-in-production href=/docs/guides/running-in-production/>Running Cortex in Production</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-auth href=/docs/guides/auth/>Authentication and Authorisation</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-aws href=/docs/guides/aws/>Running Cortex at AWS</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ruler-sharding href=/docs/guides/ruler-sharding/>Config for horizontally scaling the Ruler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ha-pair-handling href=/docs/guides/ha-pair-handling/>Config for sending HA Pairs data to Cortex</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-caching href=/docs/guides/caching/>Caching in Cortex</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ingester-handover href=/docs/guides/ingester-handover/>Ingester Hand-over</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ingesters-with-wal href=/docs/guides/ingesters-with-wal/>Ingesters with WAL</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-zone-aware-replication href=/docs/guides/zone-aware-replication/>Zone Aware Replication</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-tracing href=/docs/guides/tracing/>Tracing</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-cassandra href=/docs/guides/cassandra/>Running Cortex with Cassandra</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/configuration/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configuration</a></li><ul><li class=collapse id=docs-configuration><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-configuration-file href=/docs/configuration/configuration-file/>Configuration file</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-schema-configuration href=/docs/configuration/schema-configuration/>Schema Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-arguments href=/docs/configuration/arguments/>Cortex Arguments Explained</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-prometheus-frontend href=/docs/configuration/prometheus-frontend/>Prometheus Frontend</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-single-process-config href=/docs/configuration/single-process-config/>Single-process</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/operations/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Operations</a></li><ul><li class="collapse show" id=docs-operations><a class="td-sidebar-link td-sidebar-link__page active" id=m-docs-operations-blocks-storage href=/docs/operations/blocks-storage/>Blocks storage (experimental)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-operations-query-auditor href=/docs/operations/query-auditor/>Query Auditor (tool)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-operations-query-tee href=/docs/operations/query-tee/>Query Tee (service)</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/contributing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contributing</a></li><ul><li class=collapse id=docs-contributing><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-design-patterns-and-code-conventions href=/docs/contributing/design-patterns-and-code-conventions/>Design patterns and Code conventions</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-how-to-run-the-website-locally href=/docs/contributing/how-to-run-the-website-locally/>How to run the website locally</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-how-to-upgrade-golang-version href=/docs/contributing/how-to-upgrade-golang-version/>How to upgrade Golang version</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-how-integration-tests-work href=/docs/contributing/how-integration-tests-work/>How integration tests work</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/governance/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Governance</a></li><ul><li class=collapse id=docs-governance><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-governance-how-to-add-a-maintainer href=/docs/governance/how-to-add-a-maintainer/>How to add a maintainer</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/proposals/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Proposals</a></li><ul><li class=collapse id=docs-proposals><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-proposals-blocks-storage-sharding href=/docs/proposals/blocks-storage-sharding/>Blocks storage sharding</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-proposals-support-metadata-api href=/docs/proposals/support-metadata-api/>Support metadata API</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-changelog href=/docs/changelog/>Changelog</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-code-of-conduct href=/docs/code-of-conduct/>Code of Conduct</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cortexproject/cortex/edit/master/docs/operations/blocks-storage.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/cortexproject/cortex/issues/new?title=Blocks%20storage%20%28experimental%29" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/cortexproject/cortex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><ul><li><a href=#how-it-works>How it works</a><ul><li><a href=#the-write-path>The write path</a></li><li><a href=#the-read-path>The read path</a></li><li><a href=#series-sharding-and-replication>Series sharding and replication</a></li><li><a href=#compactor>Compactor</a><ul><li><a href=#compactor-sharding>Compactor sharding</a></li><li><a href=#compactor-http-endpoints>Compactor HTTP endpoints</a></li></ul></li></ul></li><li><a href=#index-cache>Index cache</a><ul><li><a href=#in-memory-index-cache>In-memory index cache</a></li><li><a href=#memcached-index-cache>Memcached index cache</a></li></ul></li><li><a href=#configuration>Configuration</a><ul><li><a href=#storage-config><code>storage_config</code></a></li><li><a href=#tsdb-config><code>tsdb_config</code></a></li><li><a href=#compactor-config><code>compactor_config</code></a></li></ul></li><li><a href=#known-issues>Known issues</a><ul><li><a href=#migrating-from-the-chunks-to-the-blocks-storage>Migrating from the chunks to the blocks storage</a></li></ul></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/operations/>Operations</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/operations/blocks-storage/>Blocks storage (experimental)</a></li></ol></nav><div class=td-content><h1>Blocks storage (experimental)</h1><p>The blocks storage is an <strong>experimental</strong> Cortex storage engine based on <a href=https://prometheus.io/docs/prometheus/latest/storage/>Prometheus TSDB</a>: it stores each tenant&rsquo;s time series into their own TSDB which write out their series to a on-disk Block (defaults to 2h block range periods). Each Block is composed by chunk files - containing the timestamp-value pairs for multiple series - and an index, which indexes metric names and labels to time series in the chunk files.</p><p>The supported backends for the blocks storage are:</p><ul><li><a href=https://aws.amazon.com/s3>Amazon S3</a></li><li><a href=https://cloud.google.com/storage/>Google Cloud Storage</a></li><li><a href=https://azure.microsoft.com/en-us/services/storage/>Microsoft Azure Storage</a></li><li><a href=https://thanos.io/storage.md/#filesystem>Local Filesystem</a> (single node only)</li></ul><p><em>Internally, this storage engine is based on <a href=https://thanos.io>Thanos</a>, but no Thanos knowledge is required in order to run it.</em></p><p>The rest of the document assumes you have read the <a href=/docs/architecture/>Cortex architecture</a> documentation.</p><h2 id=how-it-works>How it works</h2><p>When the blocks storage is used, each <strong>ingester</strong> creates a per-tenant TSDB and ships the TSDB Blocks - which by default are cut every 2 hours - to the long-term storage.</p><p><strong>Queriers</strong> periodically iterate over the storage bucket to discover recently uploaded Blocks and - for each Block - download a subset of the block index - called &ldquo;index header&rdquo; - which is kept in memory and used to provide fast lookups.</p><h3 id=the-write-path>The write path</h3><p><strong>Ingesters</strong> receive incoming samples from the distributors. Each push request belongs to a tenant, and the ingester append the received samples to the specific per-tenant TSDB. The received samples are both kept in-memory and written to a write-ahead log (WAL) stored on the local disk and used to recover the in-memory series in case the ingester abruptly terminates. The per-tenant TSDB is lazily created in each ingester upon the first push request is received for that tenant.</p><p>The in-memory samples are periodically flushed to disk - and the WAL truncated - when a new TSDB Block is cut, which by default occurs every 2 hours. Each new Block cut is then uploaded to the long-term storage and kept in the ingester for some more time, in order to give queriers enough time to discover the new Block from the storage and download its index header.</p><p>In order to effectively use the <strong>WAL</strong> and being able to recover the in-memory series upon ingester abruptly termination, the WAL needs to be stored to a persistent local disk which can survive in the event of an ingester failure (ie. AWS EBS volume or GCP persistent disk when running in the cloud). For example, if you&rsquo;re running the Cortex cluster in Kubernetes, you may use a StatefulSet with a persistent volume claim for the ingesters.</p><h3 id=the-read-path>The read path</h3><p><strong>Queriers</strong> - at startup - iterate over the entire storage bucket to discover all tenants Blocks and - for each of them - download the index header. During this initial synchronization phase, a querier is not ready to handle incoming queries yet and its <code>/ready</code> readiness probe endpoint will fail.</p><p>Queriers also periodically re-iterate over the storage bucket to discover newly uploaded Blocks (by the ingesters) and find out Blocks deleted in the meanwhile, as effect of an optional retention policy.</p><p>The blocks chunks and the entire index is never fully downloaded by the queriers. In the read path, a querier lookups the series label names and values using the in-memory index header and then download the required segments of the index and chunks for the matching series directly from the long-term storage using byte-range requests.</p><p>The index header is also stored to the local disk, in order to avoid to re-download it on subsequent restarts of a querier. For this reason, it&rsquo;s recommended - but not required - to run the querier with a persistent local disk. For example, if you&rsquo;re running the Cortex cluster in Kubernetes, you may use a StatefulSet with a persistent volume claim for the queriers.</p><h3 id=series-sharding-and-replication>Series sharding and replication</h3><p>The series sharding and replication doesn&rsquo;t change based on the storage engine, so the general overview provided by the &ldquo;<a href=/docs/architecture/>Cortex architecture</a>&rdquo; documentation applies to the blocks storage as well.</p><p>It&rsquo;s important to note that - differently than the <a href=/docs/architecture/#chunks-storage-default>chunks storage</a> - time series are effectively written N times to the long-term storage, where N is the replication factor (typically 3). This may lead to a storage utilization N times more than the chunks storage, but is actually mitigated by the <a href=#compactor>compactor</a> service (see &ldquo;vertical compaction&rdquo;).</p><h3 id=compactor>Compactor</h3><p>The <strong>compactor</strong> is an optional - but highly recommended - service which compacts multiple Blocks of a given tenant into a single optimized larger Block. The compactor has two main benefits:</p><ol><li>Vertically compact Blocks uploaded by all ingesters for the same time range</li><li>Horizontally compact Blocks with small time ranges into a single larger Block</li></ol><p>The <strong>vertical compaction</strong> compacts all the Blocks of a tenant uploaded by any ingester for the same Block range period (defaults to 2 hours) into a single Block, de-duplicating samples that are originally written to N Blocks as effect of the replication.</p><p>The <strong>horizontal compaction</strong> triggers after the vertical compaction and compacts several Blocks belonging to adjacent small range periods (2 hours) into a single larger Block. Despite the total block chunks size doesn&rsquo;t change after this compaction, it may have a significative impact on the reduction of the index size and its index header kept in memory by queriers.</p><p>The compactor is <strong>stateless</strong>.</p><h4 id=compactor-sharding>Compactor sharding</h4><p>The compactor optionally supports sharding. When sharding is enabled, multiple compactor instances can coordinate to split the workload and shard blocks by tenant. All the blocks of a tenant are processed by a single compactor instance at any given time, but compaction for different tenants may simultaneously run on different compactor instances.</p><p>Whenever the pool of compactors increase or decrease (ie. following up a scale up/down), tenants are resharded across the available compactor instances without any manual intervention. Compactors coordinate via the Cortex <a href=/docs/architecture/#the-hash-ring>hash ring</a>.</p><h4 id=compactor-http-endpoints>Compactor HTTP endpoints</h4><ul><li><code>GET /compactor/ring</code><br>Displays the status of the compactors ring, including the tokens owned by each compactor and an option to remove (forget) instances from the ring.</li></ul><h2 id=index-cache>Index cache</h2><p>The querier supports a cache to speed up postings and series lookups from TSDB blocks indexes. Two backends are supported:</p><ul><li><code>inmemory</code></li><li><code>memcached</code></li></ul><h3 id=in-memory-index-cache>In-memory index cache</h3><p>The <code>inmemory</code> index cache is <strong>enabled by default</strong> and its max size can be configured through the flag <code>-experimental.tsdb.bucket-store.index-cache.inmemory.max-size-bytes</code> (or config file). The trade-off of using the in-memory index cache is:</p><ul><li>Pros: zero latency</li><li>Cons: increased querier memory usage, not shared across multiple querier replicas</li></ul><h3 id=memcached-index-cache>Memcached index cache</h3><p>The <code>memcached</code> index cache allows to use <a href=https://memcached.org/>Memcached</a> as cache backend. This cache backend is configured using <code>-experimental.tsdb.bucket-store.index-cache.backend=memcached</code> and requires the Memcached server(s) addresses via <code>-experimental.tsdb.bucket-store.index-cache.memcached.addresses</code> (or config file). The addresses are resolved using the <a href=/docs/configuration/arguments/#dns-service-discovery>DNS service provider</a>.</p><p>The trade-off of using the Memcached index cache is:</p><ul><li>Pros: can scale beyond a single node memory (Memcached cluster), shared across multiple querier instances</li><li>Cons: higher latency in the cache round trip compared to the in-memory one</li></ul><p>The Memcached client uses a jump hash algorithm to shard cached entries across a cluster of Memcached servers. For this reason, you should make sure memcached servers are <strong>not</strong> behind any kind of load balancer and their address is configured so that servers are added/removed to the end of the list whenever a scale up/down occurs.</p><p>For example, if you&rsquo;re running Memcached in Kubernetes, you may:</p><ol><li>Deploy your Memcached cluster using a <a href=https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/>StatefulSet</a></li><li>Create an <a href=https://kubernetes.io/docs/concepts/services-networking/service/#headless-services>headless service</a> for Memcached StatefulSet</li><li>Configure the Cortex&rsquo;s Memcached client address using the <code>dnssrvnoa+</code> <a href=/docs/configuration/arguments/#dns-service-discovery>service discovery</a></li></ol><h2 id=configuration>Configuration</h2><p>The general <a href=/docs/configuration/>configuration documentation</a> also applied to a Cortex cluster running the blocks storage, with few differences:</p><ul><li><a href=#storage-config><code>storage_config</code></a></li><li><a href=#tsdb-config><code>tsdb_config</code></a></li><li><a href=#compactor-config><code>compactor_config</code></a></li></ul><h3 id=storage-config><code>storage_config</code></h3><p>The <code>storage_config</code> configures the storage engine.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>storage<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># The storage engine to use. Use &#34;tsdb&#34; for the blocks storage.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -store.engine</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>engine<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>tsdb</code></pre></div><h3 id=tsdb-config><code>tsdb_config</code></h3><p>The <code>tsdb_config</code> configures the experimental blocks storage.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>tsdb<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Local directory to store TSDBs in the ingesters.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.dir</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>dir<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;tsdb&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># TSDB blocks range period.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.block-ranges-period</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>block_ranges_period<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;list<span style=color:#f8f8f8;text-decoration:underline> </span>of<span style=color:#f8f8f8;text-decoration:underline> </span>duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>2h0m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># TSDB blocks retention in the ingester before a block is removed. This should</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># be larger than the block_ranges_period and large enough to give queriers</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># enough time to discover newly uploaded blocks.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.retention-period</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>retention_period<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>6h0m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># How frequently the TSDB blocks are scanned and new ones are shipped to the</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># storage. 0 means shipping is disabled.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.ship-interval</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>ship_interval<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>1m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Maximum number of tenants concurrently shipping blocks to the storage.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.ship-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>ship_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Backend storage to use. Supported backends are: s3, gcs, azure, filesystem.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.backend</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>backend<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>bucket_store<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Directory to store synchronized TSDB index headers.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.sync-dir</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>sync_dir<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;tsdb-sync&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># How frequently scan the bucket to look for changes (new blocks shipped by</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># ingesters and blocks removed by retention or compaction). 0 disables it.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.sync-interval</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>sync_interval<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>5m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Max size - in bytes - of a per-tenant chunk pool, used to reduce memory</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># allocations.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.max-chunk-pool-bytes</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>max_chunk_pool_bytes<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2147483648</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Max number of samples per query when loading series from the long-term</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># storage. 0 disables the limit.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.max-sample-count</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>max_sample_count<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Max number of concurrent queries to execute against the long-term storage</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># on a per-tenant basis.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.max-concurrent</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>max_concurrent<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Maximum number of concurrent tenants synching blocks.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.tenant-sync-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>tenant_sync_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Maximum number of concurrent blocks synching per tenant.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.block-sync-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>block_sync_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Number of Go routines to use when syncing block meta files from object</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># storage per tenant.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.meta-sync-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>meta_sync_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Whether the bucket store should use the binary index header. If false, it</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># uses the JSON index header.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.binary-index-header-enabled</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>binary_index_header_enabled<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;boolean&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Minimum age of a block before it&#39;s being read. Set it to safe value (e.g</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># 30m) if your object storage is eventually consistent. GCS and S3 are</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># (roughly) strongly consistent.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.consistency-delay</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>consistency_delay<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>index_cache<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The index cache backend type. Supported values: inmemory, memcached.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.backend</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>[</span>backend<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;inmemory&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>inmemory<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Maximum size in bytes of in-memory index cache used to speed up blocks</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># index lookups (shared between all tenants).</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.inmemory.max-size-bytes</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_size_bytes<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1073741824</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>memcached<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Comma separated list of memcached addresses. Supported prefixes are:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># dns+ (looked up as an A/AAAA query), dnssrv+ (looked up as a SRV</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># query, dnssrvnoa+ (looked up as a SRV query, with no A/AAAA lookup</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># made after that).</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.addresses</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>addresses<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The socket read/write timeout.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.timeout</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>timeout<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>100ms<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The maximum number of idle connections that will be maintained per</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># address.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.max-idle-connections</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_idle_connections<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The maximum number of concurrent asynchronous operations can occur.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.max-async-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_async_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The maximum number of enqueued asynchronous operations allowed.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.max-async-buffer-size</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_async_buffer_size<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10000</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The maximum number of concurrent connections running get operations.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># If set to 0, concurrency is unlimited.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.max-get-multi-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_get_multi_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># The maximum number of keys a single underlying get operation should</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># run. If more keys are specified, internally keys are splitted into</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># multiple batches and fetched concurrently, honoring the max</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># concurrency. If set to 0, the max batch size is unlimited.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.bucket-store.index-cache.memcached.max-get-multi-batch-size</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>max_get_multi_batch_size<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># How frequently does Cortex try to compact TSDB head. Block is only created</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># if data covers smallest block range. Must be greater than 0 and max 5</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># minutes.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.head-compaction-interval</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>head_compaction_interval<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>1m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Maximum number of tenants concurrently compacting TSDB head into a new block</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.head-compaction-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>head_compaction_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># The number of shards of series to use in TSDB (must be a power of 2).</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Reducing this will decrease memory footprint, but can negatively impact</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># performance.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.stripe-size</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>stripe_size<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16384</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># limit the number of concurrently opening TSDB&#39;s on startup</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.max-tsdb-opening-concurrency-on-startup</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>max_tsdb_opening_concurrency_on_startup<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>s3<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># S3 endpoint without schema</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.s3.endpoint</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>endpoint<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># S3 bucket name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.s3.bucket-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>bucket_name<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># S3 secret access key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.s3.secret-access-key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>secret_access_key<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># S3 access key ID</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.s3.access-key-id</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>access_key_id<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># If enabled, use http:// for the S3 endpoint instead of https://. This</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># could be useful in local dev/test environments while using an</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># S3-compatible backend storage, like Minio.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.s3.insecure</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>insecure<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;boolean&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>gcs<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># GCS bucket name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.gcs.bucket-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>bucket_name<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># JSON representing either a Google Developers Console</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># client_credentials.json file or a Google Developers service account key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># file. If empty, fallback to Google default logic.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.gcs.service-account</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>service_account<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>azure<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Azure storage account name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.azure.account-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>account_name<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Azure storage account key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.azure.account-key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>account_key<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Azure storage container name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.azure.container-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>container_name<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Azure storage endpoint suffix without schema. The account name will be</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># prefixed to this value to create the FQDN</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.azure.endpoint-suffix</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>endpoint_suffix<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Number of retries for recoverable errors</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.azure.max-retries</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>max_retries<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>filesystem<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Local filesystem storage directory.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -experimental.tsdb.filesystem.dir</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>dir<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span></code></pre></div><h3 id=compactor-config><code>compactor_config</code></h3><p>The <code>compactor_config</code> configures the compactor for the experimental blocks storage.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>compactor<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># List of compaction time ranges.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.block-ranges</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>block_ranges<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;list<span style=color:#f8f8f8;text-decoration:underline> </span>of<span style=color:#f8f8f8;text-decoration:underline> </span>duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>2h0m0s<span style=color:#000;font-weight:700>,</span>12h0m0s<span style=color:#000;font-weight:700>,</span>24h0m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Number of Go routines to use when syncing block index and chunks files from</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># the long term storage.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.block-sync-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>block_sync_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Number of Go routines to use when syncing block meta files from the long</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># term storage.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.meta-sync-concurrency</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>meta_sync_concurrency<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Minimum age of fresh (non-compacted) blocks before they are being processed.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Malformed blocks older than the maximum of consistency-delay and 48h0m0s</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># will be removed.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.consistency-delay</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>consistency_delay<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>30m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Data directory in which to cache blocks and process compactions</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.data-dir</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>data_dir<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;./data&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># The frequency at which the compaction runs</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.compaction-interval</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>compaction_interval<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>1h0m0s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># How many times to retry a failed compaction during a single compaction</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># interval</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.compaction-retries</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>compaction_retries<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;int&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Shard tenants across multiple compactor instances. Sharding is required if</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># you run multiple compactor instances, in order to coordinate compactions and</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># avoid race conditions leading to the same tenant blocks simultaneously</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># compacted by different instances.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.sharding-enabled</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>[</span>sharding_enabled<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;boolean&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>sharding_ring<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>kvstore<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Backend storage to use for the ring. Supported values are: consul, etcd,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># inmemory, multi, memberlist (experimental).</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.store</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>[</span>store<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;consul&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The prefix for the keys in the store. Should end with a /.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.prefix</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>[</span>prefix<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;collectors/&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The consul_config configures the consul client.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The CLI flags prefix for this block config is: compactor.ring</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>[</span>consul<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;consul_config&gt;<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The etcd_config configures the etcd client.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The CLI flags prefix for this block config is: compactor.ring</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>[</span>etcd<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;etcd_config&gt;<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>multi<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Primary backend storage used by multi-client.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.multi.primary</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>primary<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Secondary backend storage used by multi-client.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.multi.secondary</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>secondary<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;string&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Mirror writes to secondary store.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.multi.mirror-enabled</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>mirror_enabled<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;boolean&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Timeout for storing value to secondary store.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.multi.mirror-timeout</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>[</span>mirror_timeout<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>2s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Period at which to heartbeat to the ring.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.heartbeat-period</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>heartbeat_period<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>5s<span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># The heartbeat timeout after which compactors are considered unhealthy</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># within the ring.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># CLI flag: -compactor.ring.heartbeat-timeout</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span>heartbeat_timeout<span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>&lt;duration&gt;<span style=color:#f8f8f8;text-decoration:underline> </span>|<span style=color:#f8f8f8;text-decoration:underline> </span>default<span style=color:#f8f8f8;text-decoration:underline> </span>=<span style=color:#f8f8f8;text-decoration:underline> </span>1m0s<span style=color:#000;font-weight:700>]</span></code></pre></div><h2 id=known-issues>Known issues</h2><h3 id=migrating-from-the-chunks-to-the-blocks-storage>Migrating from the chunks to the blocks storage</h3><p>Currently, no smooth migration path is provided to migrate from chunks to blocks storage. For this reason, the blocks storage can only be enabled in new Cortex clusters.</p><div class="text-muted mt-5 pt-3 border-top"></div></div></main></div></div><footer class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5"><div class="col-12 col-sm-4 pb-5 pb-sm-0"><img src=/images/cortex-stacked-white.png width=75px class="img-fluid float-left"></div><div class="col-12 col-sm-4 pb-5 pb-sm-0"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://slack.cncf.io class="text-reset text-white"><i class="fab fa-fw fa-slack"></i>Slack</a></li><li><a href=https://github.com/cortexproject/cortex class="text-reset text-white"><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a href=https://twitter.com/cortexmetrics class="text-reset text-white"><i class="fab fa-fw fa-twitter"></i>Twitter</a></li></ul></div><div class="col-12 col-sm-4"><h6 class=font-weight-bold>About</h6><p>Cortex is an OSS licensed project as Apache License 2.0</p></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.29b0315468c00226fa6f4556a9cebc0ac4fe1ce1457a01b22c0a06b329877383.js integrity="sha256-KbAxVGjAAib6b0VWqc68CsT&#43;HOFFegGyLAoGsymHc4M=" crossorigin=anonymous></script></body></html>