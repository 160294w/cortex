<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.59.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Changelog | Cortex</title><meta property="og:title" content="Changelog"><meta property="og:description" content="master / unreleased  [CHANGE] Utilize separate protos for rule state and storage. Experimental ruler API will not be functional until the rollout is complete. #2226 [FEATURE] Flusher target to flush the WAL.  -flusher.wal-dir for the WAL directory to recover from. -flusher.concurrent-flushes for number of concurrent flushes. -flusher.flush-op-timeout is duration after which a flush should timeout.   0.7.0-rc.0 / 2020-03-09 Cortex 0.7.0 introduces some breaking changes. You&rsquo;re encouraged to read all the [CHANGE] entries below before upgrading your Cortex cluster."><meta property="og:type" content="article"><meta property="og:url" content="/docs/changelog/"><meta property="og:image" content="/images/logo-twitter-card.jpg"><meta property="og:site_name" content="Cortex"><meta itemprop=name content="Changelog"><meta itemprop=description content="master / unreleased  [CHANGE] Utilize separate protos for rule state and storage. Experimental ruler API will not be functional until the rollout is complete. #2226 [FEATURE] Flusher target to flush the WAL.  -flusher.wal-dir for the WAL directory to recover from. -flusher.concurrent-flushes for number of concurrent flushes. -flusher.flush-op-timeout is duration after which a flush should timeout.   0.7.0-rc.0 / 2020-03-09 Cortex 0.7.0 introduces some breaking changes. You&rsquo;re encouraged to read all the [CHANGE] entries below before upgrading your Cortex cluster."><meta itemprop=wordCount content="3855"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/logo-twitter-card.jpg"><meta name=twitter:title content="Changelog"><meta name=twitter:description content="master / unreleased  [CHANGE] Utilize separate protos for rule state and storage. Experimental ruler API will not be functional until the rollout is complete. #2226 [FEATURE] Flusher target to flush the WAL.  -flusher.wal-dir for the WAL directory to recover from. -flusher.concurrent-flushes for number of concurrent flushes. -flusher.flush-op-timeout is duration after which a flush should timeout.   0.7.0-rc.0 / 2020-03-09 Cortex 0.7.0 introduces some breaking changes. You&rsquo;re encouraged to read all the [CHANGE] entries below before upgrading your Cortex cluster."><link rel=preload href=/scss/main.min.4ff813ae4617e8aa437e422dee0b5f0d0d29f44049ee9dc629d104243b05d88b.css as=style><link href=/scss/main.min.4ff813ae4617e8aa437e422dee0b5f0d0d29f44049ee9dc629d104243b05d88b.css rel=stylesheet integrity><link href=/css/offline-search.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.1.6/lunr.js></script><script src=/js/offline-search.js></script><title>Changelog | Cortex</title></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar navbar-nocover"><a id=cortex-logo class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-17.92 -14.92 1191.84 462.84"><defs><style>.cls-1{fill:#fff}</style></defs><path d="M214.531 8.017C99.353 8.017 5.65 101.72 5.65 216.899S99.353 425.78 214.531 425.78s208.882-93.704 208.882-208.882S329.71 8.017 214.531 8.017zm0 408.558c-110.102.0-199.676-89.574-199.676-199.676S104.429 17.222 214.53 17.222 414.208 106.797 414.208 216.9 324.633 416.575 214.53 416.575z" class="cls-1"/><circle cx="327.452" cy="221.633" r="34.571" class="cls-1"/><circle cx="213.713" cy="353.584" r="34.571" class="cls-1"/><path d="M299.992 167.913l-59-56.05a34.578 34.578.0 1 0-4.343 4.34l57.828 54.937a60.158 60.158.0 0 0-27.168 49.123h-12.97l-23.456-67.02-26.055 64.718H175.73l-24.724 57.22-21.808-54.524-.063.025v-.586h-22.048a34.582 34.582.0 1 0-.275 6.138h18.005l25.97 64.925 28.977-67.06h29.207l21.51-53.424 19.503 55.725H267.5a60.173 60.173.0 0 0 25.202 44.11l-56.52 56.52 4.34 4.338 57.492-57.492a60.155 60.155.0 1 0 1.977-105.963zm81.481 53.515a54.02 54.02.0 1 1-54.022-54.02 54.083 54.083.0 0 1 54.022 54.02zm175.707 42.568q-8.797 8.178-24.405 8.177a34.858 34.858.0 0 1-17.095-3.965 33.188 33.188.0 0 1-11.643-10.529 46.374 46.374.0 0 1-6.566-14.99 71.134 71.134.0 0 1-2.105-17.341 86.99 86.99.0 0 1 1.982-18.706 46.804 46.804.0 0 1 6.565-15.98 34.028 34.028.0 0 1 12.263-11.149q7.675-4.21 19.077-4.212 13.38.0 21.306 6.69 7.927 6.689 10.405 18.829h21.803a50.76 50.76.0 0 0-5.946-19.696 44.06 44.06.0 0 0-12.015-13.75 49.842 49.842.0 0 0-16.848-8.051 77.44 77.44.0 0 0-20.44-2.601q-15.114.0-26.509 5.326a52.935 52.935.0 0 0-18.952 14.617 62.165 62.165.0 0 0-11.273 21.8 94.013 94.013.0 0 0-3.717 26.883 86.195 86.195.0 0 0 3.84 26.386 57.783 57.783.0 0 0 11.397 20.686 50.138 50.138.0 0 0 18.829 13.38 66.766 66.766.0 0 0 25.891 4.705q24.527.0 38.772-12.882 14.245-12.878 17.715-36.668h-21.556q-1.986 14.867-10.776 23.041zm157.44-87.828a56.338 56.338.0 0 0-19.447-14.244q-11.52-5.203-26.882-5.203-15.115.0-26.756 5.203a56.009 56.009.0 0 0-19.573 14.244 59.75 59.75.0 0 0-11.892 21.307 85.299 85.299.0 0 0-3.965 26.386 84.117 84.117.0 0 0 3.965 26.262 59.853 59.853.0 0 0 11.892 21.183 54.61 54.61.0 0 0 19.573 14.12q11.643 5.077 26.756 5.08 15.36.0 26.882-5.08a54.908 54.908.0 0 0 19.447-14.12 59.95 59.95.0 0 0 11.892-21.183 84.181 84.181.0 0 0 3.965-26.262 85.364 85.364.0 0 0-3.965-26.386 59.846 59.846.0 0 0-11.892-21.307zm-9.538 68.38a43.305 43.305.0 0 1-8.548 15.113 37.061 37.061.0 0 1-12.759 9.29 38.825 38.825.0 0 1-30.968.0 37.003 37.003.0 0 1-12.76-9.29 43.209 43.209.0 0 1-8.547-15.114 70.669 70.669.0 0 1 0-41.373 44.634 44.634.0 0 1 8.547-15.237 36.428 36.428.0 0 1 12.76-9.415 38.826 38.826.0 0 1 30.968.0 36.484 36.484.0 0 1 12.76 9.415 44.735 44.735.0 0 1 8.547 15.237 70.624 70.624.0 0 1 0 41.373zm81.141-80.89q-11.147 7.434-18.83 23.041h-.493v-27.005h-19.82V287.78h21.057v-56.984a87.528 87.528.0 0 1 2.478-21.924 41.993 41.993.0 0 1 7.93-16.228 33.951 33.951.0 0 1 14.368-10.158q8.919-3.468 21.555-3.468V156.72q-17.097-.493-28.245 6.937zm80.761-42.366h-21.06v38.402h-21.8v18.581h21.8v81.51a48.668 48.668.0 0 0 1.734 14.37 17.432 17.432.0 0 0 5.326 8.423 20.57 20.57.0 0 0 9.415 4.088 75.59 75.59.0 0 0 13.999 1.115h16.104v-18.582h-9.664a70.335 70.335.0 0 1-8.05-.37 10.361 10.361.0 0 1-4.833-1.611 6.108 6.108.0 0 1-2.354-3.469 23.006 23.006.0 0 1-.617-5.946v-79.528h25.518v-18.581h-25.518zm148.522 60.452a56.135 56.135.0 0 0-18.085-17.962q-11.276-7.063-28.367-7.06a58.263 58.263.0 0 0-24.155 4.953 56.796 56.796.0 0 0-19.079 13.875 63.949 63.949.0 0 0-12.51 21.058 77.064 77.064.0 0 0-4.461 26.758 102.521 102.521.0 0 0 4.338 27.004 58.87 58.87.0 0 0 11.519 21.307 52.43 52.43.0 0 0 18.953 13.873q11.272 4.954 26.632 4.955 21.8.0 36.173-10.901 14.364-10.898 18.58-32.455h-20.81q-2.73 12.635-11.272 18.829-8.549 6.198-21.927 6.195a43.577 43.577.0 0 1-18.085-3.468 35.417 35.417.0 0 1-12.636-9.291 36.127 36.127.0 0 1-7.184-13.38 50.746 50.746.0 0 1-1.981-15.98h95.879a102.07 102.07.0 0 0-2.107-24.526 71.064 71.064.0 0 0-9.415-23.784zm-84.357 29.73a43.81 43.81.0 0 1 3.219-13.999 37.354 37.354.0 0 1 7.433-11.52 34.013 34.013.0 0 1 11.272-7.803 36.694 36.694.0 0 1 14.74-2.85 36.062 36.062.0 0 1 14.494 2.85 36.492 36.492.0 0 1 11.398 7.68 36.107 36.107.0 0 1 7.68 11.52 43.253 43.253.0 0 1 3.345 14.122zm170.95 7.184 44.1-58.964h-25.271l-31.961 44.843-30.721-44.843h-27.006l44.595 60.698-48.063 67.389h25.518l35.677-53.019 35.676 53.019h27.006l-49.55-69.123z" class="cls-1"/></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://twitter.com/cortexmetrics class="nav-link active"><span class=active><i class="fab fa-fw fa-twitter"></i>Twitter</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://github.com/cortexproject class="nav-link active"><span class=active><i class="fab fa-fw fa-github"></i>Github</span></a></li></ul></div><div class="navbar-nav d-none d-md-block"><div id=search-nav-container><input type=search id=search-input autocomplete=off class="form-control td-search-input" placeholder="&#xf002 Search this siteâ€¦" autocomplete=on><div id=search-results class=container></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=docs><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-getting-started href=/docs/getting-started/>Getting Started</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-architecture href=/docs/architecture/>Architecture</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-apis href=/docs/apis/>Cortex APIs</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/guides/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Guides</a></li><ul><li class=collapse id=docs-guides><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-running-in-production href=/docs/guides/running-in-production/>Running Cortex in Production</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-auth href=/docs/guides/auth/>Authentication and Authorisation</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-aws href=/docs/guides/aws/>Running Cortex at AWS</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ruler-sharding href=/docs/guides/ruler-sharding/>Config for horizontally scaling the Ruler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ha-pair-handling href=/docs/guides/ha-pair-handling/>Config for sending HA Pairs data to Cortex</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-caching href=/docs/guides/caching/>Caching in Cortex</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ingester-handover href=/docs/guides/ingester-handover/>Ingester Hand-over</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-ingesters-with-wal href=/docs/guides/ingesters-with-wal/>Ingesters with WAL</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-tracing href=/docs/guides/tracing/>Tracing</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-guides-cassandra href=/docs/guides/cassandra/>Running Cortex with Cassandra</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/configuration/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configuration</a></li><ul><li class=collapse id=docs-configuration><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-configuration-file href=/docs/configuration/configuration-file/>Configuration file</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-schema-configuration href=/docs/configuration/schema-configuration/>Schema Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-arguments href=/docs/configuration/arguments/>Cortex Arguments Explained</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-prometheus-frontend href=/docs/configuration/prometheus-frontend/>Prometheus Frontend</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-configuration-single-process-config href=/docs/configuration/single-process-config/>Single-process</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/operations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Operations</a></li><ul><li class=collapse id=docs-operations><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-operations-blocks-storage href=/docs/operations/blocks-storage/>Blocks storage (experimental)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-operations-query-auditor href=/docs/operations/query-auditor/>Query Auditor (tool)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-operations-query-tee href=/docs/operations/query-tee/>Query Tee (service)</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/contributing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contributing</a></li><ul><li class=collapse id=docs-contributing><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-how-to-run-the-website-locally href=/docs/contributing/how-to-run-the-website-locally/>How to run the website locally</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-contributing-how-to-upgrade-golang-version href=/docs/contributing/how-to-upgrade-golang-version/>How to upgrade Golang version</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/governance/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Governance</a></li><ul><li class=collapse id=docs-governance><a class="td-sidebar-link td-sidebar-link__page" id=m-docs-governance-how-to-add-a-maintainer href=/docs/governance/how-to-add-a-maintainer/>How to add a maintainer</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page active" id=m-docs-changelog href=/docs/changelog/>Changelog</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docs-code-of-conduct href=/docs/code-of-conduct/>Code of Conduct</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cortexproject/cortex/edit/master/CHANGELOG.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/cortexproject/cortex/issues/new?title=Changelog" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/cortexproject/cortex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><ul><li><a href=#master-unreleased>master / unreleased</a></li><li><a href=#0-7-0-rc-0-2020-03-09>0.7.0-rc.0 / 2020-03-09</a><ul><li><a href=#full-changelog>Full changelog</a></li><li><a href=#changes-to-denormalised-tokens-in-the-ring>Changes to denormalised tokens in the ring</a></li></ul></li><li><a href=#0-6-1-2020-02-05>0.6.1 / 2020-02-05</a></li><li><a href=#0-6-0-2020-01-28>0.6.0 / 2020-01-28</a><ul><li><a href=#upgrading-postgresql-if-you-re-using-configs-service>Upgrading PostgreSQL (if you&rsquo;re using configs service)</a></li><li><a href=#known-issues>Known issues</a></li></ul></li><li><a href=#0-4-0-2019-12-02>0.4.0 / 2019-12-02</a></li><li><a href=#0-3-0-2019-10-11>0.3.0 / 2019-10-11</a></li><li><a href=#0-2-0-2019-09-05>0.2.0 / 2019-09-05</a></li><li><a href=#0-1-0-2019-08-07>0.1.0 / 2019-08-07</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/changelog/>Changelog</a></li></ol></nav><div class=td-content><h1>Changelog</h1><h2 id=master-unreleased>master / unreleased</h2><ul><li>[CHANGE] Utilize separate protos for rule state and storage. Experimental ruler API will not be functional until the rollout is complete. <a href=https://github.com/cortexproject/cortex/pull/2226>#2226</a></li><li>[FEATURE] Flusher target to flush the WAL.<ul><li><code>-flusher.wal-dir</code> for the WAL directory to recover from.</li><li><code>-flusher.concurrent-flushes</code> for number of concurrent flushes.</li><li><code>-flusher.flush-op-timeout</code> is duration after which a flush should timeout.</li></ul></li></ul><h2 id=0-7-0-rc-0-2020-03-09>0.7.0-rc.0 / 2020-03-09</h2><p>Cortex <code>0.7.0</code> introduces some <strong>breaking changes</strong>. You&rsquo;re encouraged to read all the <code>[CHANGE]</code> entries below before upgrading your Cortex cluster. In particular:</p><ul><li>Cleaned up some configuration options in preparation for the Cortex <code>1.0.0</code> release:<ul><li>Removed CLI flags support to configure the schema (see <a href=https://cortexmetrics.io/docs/configuration/schema-configuration/#migrating-from-flags-to-schema-file>how to migrate from flags to schema file</a>)</li><li>Renamed CLI flag <code>-config-yaml</code> to <code>-schema-config-file</code></li><li>Removed CLI flag <code>-store.min-chunk-age</code> in favor of <code>-querier.query-store-after</code>. The corresponding YAML config option <code>ingestermaxquerylookback</code> has been renamed to <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#querier-config><code>query_ingesters_within</code></a></li><li>Deprecated CLI flag <code>-frontend.cache-split-interval</code> in favor of <code>-querier.split-queries-by-interval</code></li><li>Renamed the YAML config option <code>defaul_validity</code> to <code>default_validity</code></li><li>Removed the YAML config option <code>config_store</code> (in the <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#alertmanager-config><code>alertmanager YAML config</code></a>) in favor of <code>store</code></li><li>Removed the YAML config root block <code>configdb</code> in favor of <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#configs-config><code>configs</code></a>. This change is also reflected in the following CLI flags renaming:<ul><li><code>-database.*</code> -&gt; <code>-configs.database.*</code></li><li><code>-database.migrations</code> -&gt; <code>-configs.database.migrations-dir</code></li></ul></li><li>Removed the fluentd-based billing infrastructure including the CLI flags:<ul><li><code>-distributor.enable-billing</code></li><li><code>-billing.max-buffered-events</code></li><li><code>-billing.retry-delay</code></li><li><code>-billing.ingester</code></li></ul></li></ul></li><li>Removed support for using denormalised tokens in the ring. Before upgrading, make sure your Cortex cluster is already running <code>v0.6.0</code> or an earlier version with <code>-ingester.normalise-tokens=true</code></li></ul><h3 id=full-changelog>Full changelog</h3><ul><li>[CHANGE] Removed support for flags to configure schema. Further, the flag for specifying the config file (<code>-config-yaml</code>) has been deprecated. Please use <code>-schema-config-file</code>. See the <a href=https://cortexmetrics.io/docs/configuration/schema-configuration/>Schema Configuration documentation</a> for more details on how to configure the schema using the YAML file. <a href=https://github.com/cortexproject/cortex/pull/2221>#2221</a></li><li>[CHANGE] Config file changed to remove top level <code>config_store</code> field in favor of a nested <code>configdb</code> field. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[CHANGE] Removed unnecessary <code>frontend.cache-split-interval</code> in favor of <code>querier.split-queries-by-interval</code> both to reduce configuration complexity and guarantee alignment of these two configs. Starting from now, <code>-querier.cache-results</code> may only be enabled in conjunction with <code>-querier.split-queries-by-interval</code> (previously the cache interval default was <code>24h</code> so if you want to preserve the same behaviour you should set <code>-querier.split-queries-by-interval=24h</code>). <a href=https://github.com/cortexproject/cortex/pull/2040>#2040</a></li><li>[CHANGE] Renamed Configs configuration options. <a href=https://github.com/cortexproject/cortex/pull/2187>#2187</a><ul><li>configuration options</li><li><code>-database.*</code> -&gt; <code>-configs.database.*</code></li><li><code>-database.migrations</code> -&gt; <code>-configs.database.migrations-dir</code></li><li>config file</li><li><code>configdb.uri:</code> -&gt; <code>configs.database.uri:</code></li><li><code>configdb.migrationsdir:</code> -&gt; <code>configs.database.migrations_dir:</code></li><li><code>configdb.passwordfile:</code> -&gt; <code>configs.database.password_file:</code></li></ul></li><li>[CHANGE] Moved <code>-store.min-chunk-age</code> to the Querier config as <code>-querier.query-store-after</code>, allowing the store to be skipped during query time if the metrics wouldn&rsquo;t be found. The YAML config option <code>ingestermaxquerylookback</code> has been renamed to <code>query_ingesters_within</code> to match its CLI flag. <a href=https://github.com/cortexproject/cortex/pull/1893>#1893</a></li><li>[CHANGE] Renamed the cache configuration setting <code>defaul_validity</code> to <code>default_validity</code>. <a href=https://github.com/cortexproject/cortex/pull/2140>#2140</a></li><li>[CHANGE] Remove fluentd-based billing infrastructure and flags such as <code>-distributor.enable-billing</code>. <a href=https://github.com/cortexproject/cortex/pull/1491>#1491</a></li><li>[CHANGE] Removed remaining support for using denormalised tokens in the ring. If you&rsquo;re still running ingesters with denormalised tokens (Cortex 0.4 or earlier, with <code>-ingester.normalise-tokens=false</code>), such ingesters will now be completely invisible to distributors and need to be either switched to Cortex 0.6.0 or later, or be configured to use normalised tokens. <a href=https://github.com/cortexproject/cortex/pull/2034>#2034</a></li><li>[CHANGE] The frontend http server will now send 502 in case of deadline exceeded and 499 if the user requested cancellation. <a href=https://github.com/cortexproject/cortex/pull/2156>#2156</a></li><li>[CHANGE] We now enforce queries to be up to <code>-querier.max-query-into-future</code> into the future (defaults to 10m). <a href=https://github.com/cortexproject/cortex/pull/1929>#1929</a><ul><li><code>-store.min-chunk-age</code> has been removed</li><li><code>-querier.query-store-after</code> has been added in it&rsquo;s place.</li></ul></li><li>[CHANGE] Removed unused <code>/validate_expr endpoint</code>. <a href=https://github.com/cortexproject/cortex/pull/2152>#2152</a></li><li>[CHANGE] Updated Prometheus dependency to v2.16.0. This Prometheus version uses Active Query Tracker to limit concurrent queries. In order to keep <code>-querier.max-concurrent</code> working, Active Query Tracker is enabled by default, and is configured to store its data to <code>active-query-tracker</code> directory (relative to current directory when Cortex started). This can be changed by using <code>-querier.active-query-tracker-dir</code> option. Purpose of Active Query Tracker is to log queries that were running when Cortex crashes. This logging happens on next Cortex start. <a href=https://github.com/cortexproject/cortex/pull/2088>#2088</a></li><li>[CHANGE] Default to BigChunk encoding; may result in slightly higher disk usage if many timeseries have a constant value, but should generally result in fewer, bigger chunks. <a href=https://github.com/cortexproject/cortex/pull/2207>#2207</a></li><li>[CHANGE] WAL replays are now done while the rest of Cortex is starting, and more specifically, when HTTP server is running. This makes it possible to scrape metrics during WAL replays. Applies to both chunks and experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2222>#2222</a></li><li>[CHANGE] Cortex now has <code>/ready</code> probe for all services, not just ingester and querier as before. In single-binary mode, /ready reports 204 only if all components are running properly. <a href=https://github.com/cortexproject/cortex/pull/2166>#2166</a></li><li>[CHANGE] If you are vendoring Cortex and use its components in your project, be aware that many Cortex components no longer start automatically when they are created. You may want to review PR and attached document. <a href=https://github.com/cortexproject/cortex/pull/2166>#2166</a></li><li>[CHANGE] Experimental TSDB: the querier in-memory index cache used by the experimental blocks storage shifted from per-tenant to per-querier. The <code>-experimental.tsdb.bucket-store.index-cache-size-bytes</code> now configures the per-querier index cache max size instead of a per-tenant cache and its default has been increased to 1GB. <a href=https://github.com/cortexproject/cortex/pull/2189>#2189</a></li><li>[CHANGE] Experimental TSDB: TSDB head compaction interval and concurrency is now configurable (defaults to 1 min interval and 5 concurrent head compactions). New options: <code>-experimental.tsdb.head-compaction-interval</code> and <code>-experimental.tsdb.head-compaction-concurrency</code>. <a href=https://github.com/cortexproject/cortex/pull/2172>#2172</a></li><li>[CHANGE] Experimental TSDB: switched the blocks storage index header to the binary format. This change is expected to have no visible impact, except lower startup times and memory usage in the queriers. It&rsquo;s possible to switch back to the old JSON format via the flag <code>-experimental.tsdb.bucket-store.binary-index-header-enabled=false</code>. <a href=https://github.com/cortexproject/cortex/pull/2223>#2223</a></li><li>[CHANGE] Experimental Memberlist KV store can now be used in single-binary Cortex. Attempts to use it previously would fail with panic. This change also breaks existing binary protocol used to exchange gossip messages, so this version will not be able to understand gossiped Ring when used in combination with the previous version of Cortex. Easiest way to upgrade is to shutdown old Cortex installation, and restart it with new version. Incremental rollout works too, but with reduced functionality until all components run the same version. <a href=https://github.com/cortexproject/cortex/pull/2016>#2016</a></li><li>[FEATURE] Added a read-only local alertmanager config store using files named corresponding to their tenant id. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[FEATURE] Added flag <code>-experimental.ruler.enable-api</code> to enable the ruler api which implements the Prometheus API <code>/api/v1/rules</code> and <code>/api/v1/alerts</code> endpoints under the configured <code>-http.prefix</code>. <a href=https://github.com/cortexproject/cortex/pull/1999>#1999</a></li><li>[FEATURE] Added sharding support to compactor when using the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2113>#2113</a></li><li>[FEATURE] Added ability to override YAML config file settings using environment variables. <a href=https://github.com/cortexproject/cortex/pull/2147>#2147</a><ul><li><code>-config.expand-env</code></li></ul></li><li>[FEATURE] Added flags to disable Alertmanager notifications methods. <a href=https://github.com/cortexproject/cortex/pull/2187>#2187</a><ul><li><code>-configs.notifications.disable-email</code></li><li><code>-configs.notifications.disable-webhook</code></li></ul></li><li>[FEATURE] Add /config HTTP endpoint which exposes the current Cortex configuration as YAML. <a href=https://github.com/cortexproject/cortex/pull/2165>#2165</a></li><li>[FEATURE] Allow Prometheus remote write directly to ingesters. <a href=https://github.com/cortexproject/cortex/pull/1491>#1491</a></li><li>[FEATURE] Introduced new standalone service <code>query-tee</code> that can be used for testing purposes to send the same Prometheus query to multiple backends (ie. two Cortex clusters ingesting the same metrics) and compare the performances. <a href=https://github.com/cortexproject/cortex/pull/2203>#2203</a></li><li>[FEATURE] Fan out parallelizable queries to backend queriers concurrently. <a href=https://github.com/cortexproject/cortex/pull/1878>#1878</a><ul><li><code>querier.parallelise-shardable-queries</code> (bool)</li><li>Requires a shard-compatible schema (v10+)</li><li>This causes the number of traces to increase accordingly.</li><li>The query-frontend now requires a schema config to determine how/when to shard queries, either from a file or from flags (i.e. by the <code>config-yaml</code> CLI flag). This is the same schema config the queriers consume. The schema is only required to use this option.</li><li>It&rsquo;s also advised to increase downstream concurrency controls as well:</li><li><code>querier.max-outstanding-requests-per-tenant</code></li><li><code>querier.max-query-parallelism</code></li><li><code>querier.max-concurrent</code></li><li><code>server.grpc-max-concurrent-streams</code> (for both query-frontends and queriers)</li></ul></li><li>[FEATURE] Added user sub rings to distribute users to a subset of ingesters. <a href=https://github.com/cortexproject/cortex/pull/1947>#1947</a><ul><li><code>-experimental.distributor.user-subring-size</code></li></ul></li><li>[FEATURE] Add flag <code>-experimental.tsdb.stripe-size</code> to expose TSDB stripe size option. <a href=https://github.com/cortexproject/cortex/pull/2185>#2185</a></li><li>[FEATURE] Experimental Delete Series: Added support for Deleting Series with Prometheus style API. Needs to be enabled first by setting <code>-purger.enable</code> to <code>true</code>. Deletion only supported when using <code>boltdb</code> and <code>filesystem</code> as index and object store respectively. Support for other stores to follow in separate PRs <a href=https://github.com/cortexproject/cortex/pull/2103>#2103</a></li><li>[ENHANCEMENT] Alertmanager: Expose Per-tenant alertmanager metrics <a href=https://github.com/cortexproject/cortex/pull/2124>#2124</a></li><li>[ENHANCEMENT] Add <code>status</code> label to <code>cortex_alertmanager_configs</code> metric to gauge the number of valid and invalid configs. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[ENHANCEMENT] Cassandra Authentication: added the <code>custom_authenticators</code> config option that allows users to authenticate with cassandra clusters using password authenticators that are not approved by default in <a href=https://github.com/gocql/gocql/blob/81b8263d9fe526782a588ef94d3fa5c6148e5d67/conn.go#L27>gocql</a> <a href=https://github.com/cortexproject/cortex/pull/2093>#2093</a></li><li>[ENHANCEMENT] Cassandra Storage: added <code>max_retries</code>, <code>retry_min_backoff</code> and <code>retry_max_backoff</code> configuration options to enable retrying recoverable errors. <a href=https://github.com/cortexproject/cortex/pull/2054>#2054</a></li><li>[ENHANCEMENT] Allow to configure HTTP and gRPC server listen address, maximum number of simultaneous connections and connection keepalive settings.<ul><li><code>-server.http-listen-address</code></li><li><code>-server.http-conn-limit</code></li><li><code>-server.grpc-listen-address</code></li><li><code>-server.grpc-conn-limit</code></li><li><code>-server.grpc.keepalive.max-connection-idle</code></li><li><code>-server.grpc.keepalive.max-connection-age</code></li><li><code>-server.grpc.keepalive.max-connection-age-grace</code></li><li><code>-server.grpc.keepalive.time</code></li><li><code>-server.grpc.keepalive.timeout</code></li></ul></li><li>[ENHANCEMENT] PostgreSQL: Bump up <code>github.com/lib/pq</code> from <code>v1.0.0</code> to <code>v1.3.0</code> to support PostgreSQL SCRAM-SHA-256 authentication. <a href=https://github.com/cortexproject/cortex/pull/2097>#2097</a></li><li>[ENHANCEMENT] Cassandra Storage: User no longer need <code>CREATE</code> privilege on <code>&lt;all keyspaces&gt;</code> if given keyspace exists. <a href=https://github.com/cortexproject/cortex/pull/2032>#2032</a></li><li>[ENHANCEMENT] Cassandra Storage: added <code>password_file</code> configuration options to enable reading Cassandra password from file. <a href=https://github.com/cortexproject/cortex/pull/2096>#2096</a></li><li>[ENHANCEMENT] Configs API: Allow GET/POST configs in YAML format. <a href=https://github.com/cortexproject/cortex/pull/2181>#2181</a></li><li>[ENHANCEMENT] Background cache writes are batched to improve parallelism and observability. <a href=https://github.com/cortexproject/cortex/pull/2135>#2135</a></li><li>[ENHANCEMENT] Add automatic repair for checkpoint and WAL. <a href=https://github.com/cortexproject/cortex/pull/2105>#2105</a></li><li>[ENHANCEMENT] Support <code>lastEvaluation</code> and <code>evaluationTime</code> in <code>/api/v1/rules</code> endpoints and make order of groups stable. <a href=https://github.com/cortexproject/cortex/pull/2196>#2196</a></li><li>[ENHANCEMENT] Skip expired requests in query-frontend scheduling. <a href=https://github.com/cortexproject/cortex/pull/2082>#2082</a></li><li>[ENHANCEMENT] Experimental TSDB: Export TSDB Syncer metrics from Compactor component, they are prefixed with <code>cortex_compactor_</code>. <a href=https://github.com/cortexproject/cortex/pull/2023>#2023</a></li><li>[ENHANCEMENT] Experimental TSDB: Added dedicated flag <code>-experimental.tsdb.bucket-store.tenant-sync-concurrency</code> to configure the maximum number of concurrent tenants for which blocks are synched. <a href=https://github.com/cortexproject/cortex/pull/2026>#2026</a></li><li>[ENHANCEMENT] Experimental TSDB: Expose metrics for objstore operations (prefixed with <code>cortex_&lt;component&gt;_thanos_objstore_</code>, component being one of <code>ingester</code>, <code>querier</code> and <code>compactor</code>). <a href=https://github.com/cortexproject/cortex/pull/2027>#2027</a></li><li>[ENHANCEMENT] Experimental TSDB: Added support for Azure Storage to be used for block storage, in addition to S3 and GCS. <a href=https://github.com/cortexproject/cortex/pull/2083>#2083</a></li><li>[ENHANCEMENT] Experimental TSDB: Reduced memory allocations in the ingesters when using the experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2057>#2057</a></li><li>[ENHANCEMENT] Experimental Memberlist KV: expose <code>-memberlist.gossip-to-dead-nodes-time</code> and <code>-memberlist.dead-node-reclaim-time</code> options to control how memberlist library handles dead nodes and name reuse. <a href=https://github.com/cortexproject/cortex/pull/2131>#2131</a></li><li>[BUGFIX] Alertmanager: fixed panic upon applying a new config, caused by duplicate metrics registration in the <code>NewPipelineBuilder</code> function. <a href=https://github.com/cortexproject/cortex/pull/211>#211</a></li><li>[BUGFIX] Azure Blob ChunkStore: Fixed issue causing <code>invalid chunk checksum</code> errors. <a href=https://github.com/cortexproject/cortex/pull/2074>#2074</a></li><li>[BUGFIX] The gauge <code>cortex_overrides_last_reload_successful</code> is now only exported by components that use a <code>RuntimeConfigManager</code>. Previously, for components that do not initialize a <code>RuntimeConfigManager</code> (such as the compactor) the gauge was initialized with 0 (indicating error state) and then never updated, resulting in a false-negative permanent error state. <a href=https://github.com/cortexproject/cortex/pull/2092>#2092</a></li><li>[BUGFIX] Fixed WAL metric names, added the <code>cortex_</code> prefix.</li><li>[BUGFIX] Restored histogram <code>cortex_configs_request_duration_seconds</code> <a href=https://github.com/cortexproject/cortex/pull/2138>#2138</a></li><li>[BUGFIX] Fix wrong syntax for <code>url</code> in config-file-reference. <a href=https://github.com/cortexproject/cortex/pull/2148>#2148</a></li><li>[BUGFIX] Fixed some 5xx status code returned by the query-frontend when they should actually be 4xx. <a href=https://github.com/cortexproject/cortex/pull/2122>#2122</a></li><li>[BUGFIX] Experimental TSDB: fixed <code>/all_user_stats</code> and <code>/api/prom/user_stats</code> endpoints when using the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2042>#2042</a></li><li>[BUGFIX] Experimental TSDB: fixed ruler to correctly work with the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2101>#2101</a></li></ul><h3 id=changes-to-denormalised-tokens-in-the-ring>Changes to denormalised tokens in the ring</h3><p>Cortex 0.4.0 is the last version that can <em>write</em> denormalised tokens. Cortex 0.5.0 and above always write normalised tokens.</p><p>Cortex 0.6.0 is the last version that can <em>read</em> denormalised tokens. Starting with Cortex 0.7.0 only normalised tokens are supported, and ingesters writing denormalised tokens to the ring (running Cortex 0.4.0 or earlier with <code>-ingester.normalise-tokens=false</code>) are ignored by distributors. Such ingesters should either switch to using normalised tokens, or be upgraded to Cortex 0.5.0 or later.</p><h2 id=0-6-1-2020-02-05>0.6.1 / 2020-02-05</h2><ul><li>[BUGFIX] Fixed parsing of the WAL configuration when specified in the YAML config file. <a href=https://github.com/cortexproject/cortex/pull/2071>#2071</a></li></ul><h2 id=0-6-0-2020-01-28>0.6.0 / 2020-01-28</h2><p>Note that the ruler flags need to be changed in this upgrade. You&rsquo;re moving from a single node ruler to something that might need to be sharded.
Further, if you&rsquo;re using the configs service, we&rsquo;ve upgraded the migration library and this requires some manual intervention. See full instructions below to upgrade your PostgreSQL.</p><ul><li>[CHANGE] The frontend component now does not cache results if it finds a <code>Cache-Control</code> header and if one of its values is <code>no-store</code>. <a href=https://github.com/cortexproject/cortex/pull/1974>#1974</a></li><li>[CHANGE] Flags changed with transition to upstream Prometheus rules manager:<ul><li><code>-ruler.client-timeout</code> is now <code>ruler.configs.client-timeout</code> in order to match <code>ruler.configs.url</code>.</li><li><code>-ruler.group-timeout</code>has been removed.</li><li><code>-ruler.num-workers</code> has been removed.</li><li><code>-ruler.rule-path</code> has been added to specify where the prometheus rule manager will sync rule files.</li><li><code>-ruler.storage.type</code> has beem added to specify the rule store backend type, currently only the configdb.</li><li><code>-ruler.poll-interval</code> has been added to specify the interval in which to poll new rule groups.</li><li><code>-ruler.evaluation-interval</code> default value has changed from <code>15s</code> to <code>1m</code> to match the default evaluation interval in Prometheus.</li><li>Ruler sharding requires a ring which can be configured via the ring flags prefixed by <code>ruler.ring.</code>. <a href=https://github.com/cortexproject/cortex/pull/1987>#1987</a></li></ul></li><li>[CHANGE] Use relative links from /ring page to make it work when used behind reverse proxy. <a href=https://github.com/cortexproject/cortex/pull/1896>#1896</a></li><li>[CHANGE] Deprecated <code>-distributor.limiter-reload-period</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1766>#1766</a></li><li>[CHANGE] Ingesters now write only normalised tokens to the ring, although they can still read denormalised tokens used by other ingesters. <code>-ingester.normalise-tokens</code> is now deprecated, and ignored. If you want to switch back to using denormalised tokens, you need to downgrade to Cortex 0.4.0. Previous versions don&rsquo;t handle claiming tokens from normalised ingesters correctly. <a href=https://github.com/cortexproject/cortex/pull/1809>#1809</a></li><li>[CHANGE] Overrides mechanism has been renamed to &ldquo;runtime config&rdquo;, and is now separate from limits. Runtime config is simply a file that is reloaded by Cortex every couple of seconds. Limits and now also multi KV use this mechanism.<br>New arguments were introduced: <code>-runtime-config.file</code> (defaults to empty) and <code>-runtime-config.reload-period</code> (defaults to 10 seconds), which replace previously used <code>-limits.per-user-override-config</code> and <code>-limits.per-user-override-period</code> options. Old options are still used if <code>-runtime-config.file</code> is not specified. This change is also reflected in YAML configuration, where old <code>limits.per_tenant_override_config</code> and <code>limits.per_tenant_override_period</code> fields are replaced with <code>runtime_config.file</code> and <code>runtime_config.period</code> respectively. <a href=https://github.com/cortexproject/cortex/pull/1749>#1749</a></li><li>[CHANGE] Cortex now rejects data with duplicate labels. Previously, such data was accepted, with duplicate labels removed with only one value left. <a href=https://github.com/cortexproject/cortex/pull/1964>#1964</a></li><li>[CHANGE] Changed the default value for <code>-distributor.ha-tracker.prefix</code> from <code>collectors/</code> to <code>ha-tracker/</code> in order to not clash with other keys (ie. ring) stored in the same key-value store. <a href=https://github.com/cortexproject/cortex/pull/1940>#1940</a></li><li>[FEATURE] Experimental: Write-Ahead-Log added in ingesters for more data reliability against ingester crashes. <a href=https://github.com/cortexproject/cortex/pull/1103>#1103</a><ul><li><code>--ingester.wal-enabled</code>: Setting this to <code>true</code> enables writing to WAL during ingestion.</li><li><code>--ingester.wal-dir</code>: Directory where the WAL data should be stored and/or recovered from.</li><li><code>--ingester.checkpoint-enabled</code>: Set this to <code>true</code> to enable checkpointing of in-memory chunks to disk.</li><li><code>--ingester.checkpoint-duration</code>: This is the interval at which checkpoints should be created.</li><li><code>--ingester.recover-from-wal</code>: Set this to <code>true</code> to recover data from an existing WAL.</li><li>For more information, please checkout the <a href=https://cortexmetrics.io/docs/guides/ingesters-with-wal/>&ldquo;Ingesters with WAL&rdquo; guide</a>.</li></ul></li><li>[FEATURE] The distributor can now drop labels from samples (similar to the removal of the replica label for HA ingestion) per user via the <code>distributor.drop-label</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1726>#1726</a></li><li>[FEATURE] Added flag <code>debug.mutex-profile-fraction</code> to enable mutex profiling <a href=https://github.com/cortexproject/cortex/pull/1969>#1969</a></li><li>[FEATURE] Added <code>global</code> ingestion rate limiter strategy. Deprecated <code>-distributor.limiter-reload-period</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1766>#1766</a></li><li>[FEATURE] Added support for Microsoft Azure blob storage to be used for storing chunk data. <a href=https://github.com/cortexproject/cortex/pull/1913>#1913</a></li><li>[FEATURE] Added readiness probe endpoint<code>/ready</code> to queriers. <a href=https://github.com/cortexproject/cortex/pull/1934>#1934</a></li><li>[FEATURE] Added &ldquo;multi&rdquo; KV store that can interact with two other KV stores, primary one for all reads and writes, and secondary one, which only receives writes. Primary/secondary store can be modified in runtime via runtime-config mechanism (previously &ldquo;overrides&rdquo;). <a href=https://github.com/cortexproject/cortex/pull/1749>#1749</a></li><li>[FEATURE] Added support to store ring tokens to a file and read it back on startup, instead of generating/fetching the tokens to/from the ring. This feature can be enabled with the flag <code>-ingester.tokens-file-path</code>. <a href=https://github.com/cortexproject/cortex/pull/1750>#1750</a></li><li>[FEATURE] Experimental TSDB: Added <code>/series</code> API endpoint support with TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1830>#1830</a></li><li>[FEATURE] Experimental TSDB: Added TSDB blocks <code>compactor</code> component, which iterates over users blocks stored in the bucket and compact them according to the configured block ranges. <a href=https://github.com/cortexproject/cortex/pull/1942>#1942</a></li><li>[FEATURE] Experimental: Implements gRPC streaming for ingesters when using the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1845>#1845</a></li><li>[ENHANCEMENT] metric <code>cortex_ingester_flush_reasons</code> gets a new <code>reason</code> value: <code>Spread</code>, when <code>-ingester.spread-flushes</code> option is enabled. <a href=https://github.com/cortexproject/cortex/pull/1978>#1978</a></li><li>[ENHANCEMENT] Added <code>password</code> and <code>enable_tls</code> options to redis cache configuration. Enables usage of Microsoft Azure Cache for Redis service. <a href=https://github.com/cortexproject/cortex/pull/1923>#1923</a></li><li>[ENHANCEMENT] Upgraded Kubernetes API version for deployments from <code>extensions/v1beta1</code> to <code>apps/v1</code>. <a href=https://github.com/cortexproject/cortex/pull/1941>#1941</a></li><li>[ENHANCEMENT] Add ability to configure gRPC keepalive settings. <a href=https://github.com/cortexproject/cortex/pull/2066>#2066</a></li><li>[ENHANCEMENT] Experimental TSDB: Open existing TSDB on startup to prevent ingester from becoming ready before it can accept writes. The max concurrency is set via <code>--experimental.tsdb.max-tsdb-opening-concurrency-on-startup</code>. <a href=https://github.com/cortexproject/cortex/pull/1917>#1917</a></li><li>[ENHANCEMENT] Experimental TSDB: Querier now exports aggregate metrics from Thanos bucket store and in memory index cache (many metrics to list, but all have <code>cortex_querier_bucket_store_</code> or <code>cortex_querier_blocks_index_cache_</code> prefix). <a href=https://github.com/cortexproject/cortex/pull/1996>#1996</a></li><li>[ENHANCEMENT] Experimental TSDB: Improved multi-tenant bucket store. <a href=https://github.com/cortexproject/cortex/pull/1991>#1991</a><ul><li>Allowed to configure the blocks sync interval via <code>-experimental.tsdb.bucket-store.sync-interval</code> (0 disables the sync)</li><li>Limited the number of tenants concurrently synched by <code>-experimental.tsdb.bucket-store.block-sync-concurrency</code></li><li>Renamed <code>cortex_querier_sync_seconds</code> metric to <code>cortex_querier_blocks_sync_seconds</code></li><li>Track <code>cortex_querier_blocks_sync_seconds</code> metric for the initial sync too</li></ul></li><li>[BUGFIX] Fixed unnecessary CAS operations done by the HA tracker when the jitter is enabled. <a href=https://github.com/cortexproject/cortex/pull/1861>#1861</a></li><li>[BUGFIX] Fixed ingesters getting stuck in a LEAVING state after coming up from an ungraceful exit. <a href=https://github.com/cortexproject/cortex/pull/1921>#1921</a></li><li>[BUGFIX] Reduce memory usage when ingester Push() errors. <a href=https://github.com/cortexproject/cortex/pull/1922>#1922</a></li><li>[BUGFIX] Table Manager: Fixed calculation of expected tables and creation of tables from next active schema considering grace period. <a href=https://github.com/cortexproject/cortex/pull/1976>#1976</a></li><li>[BUGFIX] Fixed leaked goroutines in the querier. <a href=https://github.com/cortexproject/cortex/pull/2070>#2070</a></li><li>[BUGFIX] Experimental TSDB: Fixed ingesters consistency during hand-over when using experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1854>#1854</a> <a href=https://github.com/cortexproject/cortex/pull/1818>#1818</a></li><li>[BUGFIX] Experimental TSDB: Fixed metrics when using experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1981>#1981</a> <a href=https://github.com/cortexproject/cortex/pull/1982>#1982</a> <a href=https://github.com/cortexproject/cortex/pull/1990>#1990</a> <a href=https://github.com/cortexproject/cortex/pull/1983>#1983</a></li><li>[BUGFIX] Experimental memberlist: Use the advertised address when sending packets to other peers of the Gossip memberlist. <a href=https://github.com/cortexproject/cortex/pull/1857>#1857</a></li></ul><h3 id=upgrading-postgresql-if-you-re-using-configs-service>Upgrading PostgreSQL (if you&rsquo;re using configs service)</h3><p>Reference: <a href=https://github.com/golang-migrate/migrate/tree/master/database/postgres#upgrading-from-v1>https://github.com/golang-migrate/migrate/tree/master/database/postgres#upgrading-from-v1</a></p><ol><li>Install the migrate package cli tool: <a href=https://github.com/golang-migrate/migrate/tree/master/cmd/migrate#installation>https://github.com/golang-migrate/migrate/tree/master/cmd/migrate#installation</a></li><li>Drop the <code>schema_migrations</code> table: <code>DROP TABLE schema_migrations;</code>.</li><li><p>Run the migrate command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>migrate  -path &lt;absolute_path_to_cortex&gt;/cmd/cortex/migrations -database postgres://localhost:5432/database force <span style=color:#0000cf;font-weight:700>2</span></code></pre></div></li></ol><h3 id=known-issues>Known issues</h3><ul><li><p>The <code>cortex_prometheus_rule_group_last_evaluation_timestamp_seconds</code> metric, tracked by the ruler, is not unregistered for rule groups not being used anymore. This issue will be fixed in the next Cortex release (see <a href=https://github.com/cortexproject/cortex/issues/2033>2033</a>).</p></li><li><p>Write-Ahead-Log (WAL) does not have automatic repair of corrupt checkpoint or WAL segments, which is possible if ingester crashes abruptly or the underlying disk corrupts. Currently the only way to resolve this is to manually delete the affected checkpoint and/or WAL segments. Automatic repair will be added in the future releases.</p></li></ul><h2 id=0-4-0-2019-12-02>0.4.0 / 2019-12-02</h2><ul><li>[CHANGE] The frontend component has been refactored to be easier to re-use. When upgrading the frontend, cache entries will be discarded and re-created with the new protobuf schema. <a href=https://github.com/cortexproject/cortex/pull/1734>#1734</a></li><li>[CHANGE] Removed direct DB/API access from the ruler. <code>-ruler.configs.url</code> has been now deprecated. <a href=https://github.com/cortexproject/cortex/pull/1579>#1579</a></li><li>[CHANGE] Removed <code>Delta</code> encoding. Any old chunks with <code>Delta</code> encoding cannot be read anymore. If <code>ingester.chunk-encoding</code> is set to <code>Delta</code> the ingester will fail to start. <a href=https://github.com/cortexproject/cortex/pull/1706>#1706</a></li><li>[CHANGE] Setting <code>-ingester.max-transfer-retries</code> to 0 now disables hand-over when ingester is shutting down. Previously, zero meant infinite number of attempts. <a href=https://github.com/cortexproject/cortex/pull/1771>#1771</a></li><li>[CHANGE] <code>dynamo</code> has been removed as a valid storage name to make it consistent for all components. <code>aws</code> and <code>aws-dynamo</code> remain as valid storage names.</li><li>[CHANGE/FEATURE] The frontend split and cache intervals can now be configured using the respective flag <code>--querier.split-queries-by-interval</code> and <code>--frontend.cache-split-interval</code>.<ul><li>If <code>--querier.split-queries-by-interval</code> is not provided request splitting is disabled by default.</li><li><strong><code>--querier.split-queries-by-day</code> is still accepted for backward compatibility but has been deprecated. You should now use <code>--querier.split-queries-by-interval</code>. We recommend a to use a multiple of 24 hours.</strong></li></ul></li><li>[FEATURE] Global limit on the max series per user and metric <a href=https://github.com/cortexproject/cortex/pull/1760>#1760</a><ul><li><code>-ingester.max-global-series-per-user</code></li><li><code>-ingester.max-global-series-per-metric</code></li><li>Requires <code>-distributor.replication-factor</code> and <code>-distributor.shard-by-all-labels</code> set for the ingesters too</li></ul></li><li>[FEATURE] Flush chunks with stale markers early with <code>ingester.max-stale-chunk-idle</code>. <a href=https://github.com/cortexproject/cortex/pull/1759>#1759</a></li><li>[FEATURE] EXPERIMENTAL: Added new KV Store backend based on memberlist library. Components can gossip about tokens and ingester states, instead of using Consul or Etcd. <a href=https://github.com/cortexproject/cortex/pull/1721>#1721</a></li><li>[FEATURE] EXPERIMENTAL: Use TSDB in the ingesters &amp; flush blocks to S3/GCS ala Thanos. This will let us use an Object Store more efficiently and reduce costs. <a href=https://github.com/cortexproject/cortex/pull/1695>#1695</a></li><li>[FEATURE] Allow Query Frontend to log slow queries with <code>frontend.log-queries-longer-than</code>. <a href=https://github.com/cortexproject/cortex/pull/1744>#1744</a></li><li>[FEATURE] Add HTTP handler to trigger ingester flush &amp; shutdown - used when running as a stateful set with the WAL enabled. <a href=https://github.com/cortexproject/cortex/pull/1746>#1746</a></li><li>[FEATURE] EXPERIMENTAL: Added GCS support to TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1772>#1772</a></li><li>[ENHANCEMENT] Reduce memory allocations in the write path. <a href=https://github.com/cortexproject/cortex/pull/1706>#1706</a></li><li>[ENHANCEMENT] Consul client now follows recommended practices for blocking queries wrt returned Index value. <a href=https://github.com/cortexproject/cortex/pull/1708>#1708</a></li><li>[ENHANCEMENT] Consul client can optionally rate-limit itself during Watch (used e.g. by ring watchers) and WatchPrefix (used by HA feature) operations. Rate limiting is disabled by default. New flags added: <code>--consul.watch-rate-limit</code>, and <code>--consul.watch-burst-size</code>. <a href=https://github.com/cortexproject/cortex/pull/1708>#1708</a></li><li>[ENHANCEMENT] Added jitter to HA deduping heartbeats, configure using <code>distributor.ha-tracker.update-timeout-jitter-max</code> <a href=https://github.com/cortexproject/cortex/pull/1534>#1534</a></li><li>[ENHANCEMENT] Add ability to flush chunks with stale markers early. <a href=https://github.com/cortexproject/cortex/pull/1759>#1759</a></li><li>[BUGFIX] Stop reporting successful actions as 500 errors in KV store metrics. <a href=https://github.com/cortexproject/cortex/pull/1798>#1798</a></li><li>[BUGFIX] Fix bug where duplicate labels can be returned through metadata APIs. <a href=https://github.com/cortexproject/cortex/pull/1790>#1790</a></li><li>[BUGFIX] Fix reading of old, v3 chunk data. <a href=https://github.com/cortexproject/cortex/pull/1779>#1779</a></li><li>[BUGFIX] Now support IAM roles in service accounts in AWS EKS. <a href=https://github.com/cortexproject/cortex/pull/1803>#1803</a></li><li>[BUGFIX] Fixed duplicated series returned when querying both ingesters and store with the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1778>#1778</a></li></ul><p>In this release we updated the following dependencies:</p><ul><li>gRPC v1.25.0 (resulted in a drop of 30% CPU usage when compression is on)</li><li>jaeger-client v2.20.0</li><li>aws-sdk-go to v1.25.22</li></ul><h2 id=0-3-0-2019-10-11>0.3.0 / 2019-10-11</h2><p>This release adds support for Redis as an alternative to Memcached, and also includes many optimisations which reduce CPU and memory usage.</p><ul><li>[CHANGE] Gauge metrics were renamed to drop the <code>_total</code> suffix. <a href=https://github.com/cortexproject/cortex/pull/1685>#1685</a><ul><li>In Alertmanager, <code>alertmanager_configs_total</code> is now <code>alertmanager_configs</code></li><li>In Ruler, <code>scheduler_configs_total</code> is now <code>scheduler_configs</code></li><li><code>scheduler_groups_total</code> is now <code>scheduler_groups</code>.</li></ul></li><li>[CHANGE] <code>--alertmanager.configs.auto-slack-root</code> flag was dropped as auto Slack root is not supported anymore. <a href=https://github.com/cortexproject/cortex/pull/1597>#1597</a></li><li>[CHANGE] In table-manager, default DynamoDB capacity was reduced from 3,000 units to 1,000 units. We recommend you do not run with the defaults: find out what figures are needed for your environment and set that via <code>-dynamodb.periodic-table.write-throughput</code> and <code>-dynamodb.chunk-table.write-throughput</code>.</li><li>[FEATURE] Add Redis support for caching <a href=https://github.com/cortexproject/cortex/pull/1612>#1612</a></li><li>[FEATURE] Allow spreading chunk writes across multiple S3 buckets <a href=https://github.com/cortexproject/cortex/pull/1625>#1625</a></li><li>[FEATURE] Added <code>/shutdown</code> endpoint for ingester to shutdown all operations of the ingester. <a href=https://github.com/cortexproject/cortex/pull/1746>#1746</a></li><li>[ENHANCEMENT] Upgraded Prometheus to 2.12.0 and Alertmanager to 0.19.0. <a href=https://github.com/cortexproject/cortex/pull/1597>#1597</a></li><li>[ENHANCEMENT] Cortex is now built with Go 1.13 <a href=https://github.com/cortexproject/cortex/pull/1675>#1675</a>, <a href=https://github.com/cortexproject/cortex/pull/1676>#1676</a>, <a href=https://github.com/cortexproject/cortex/pull/1679>#1679</a></li><li>[ENHANCEMENT] Many optimisations, mostly impacting ingester and querier: <a href=https://github.com/cortexproject/cortex/pull/1574>#1574</a>, <a href=https://github.com/cortexproject/cortex/pull/1624>#1624</a>, <a href=https://github.com/cortexproject/cortex/pull/1638>#1638</a>, <a href=https://github.com/cortexproject/cortex/pull/1644>#1644</a>, <a href=https://github.com/cortexproject/cortex/pull/1649>#1649</a>, <a href=https://github.com/cortexproject/cortex/pull/1654>#1654</a>, <a href=https://github.com/cortexproject/cortex/pull/1702>#1702</a></li></ul><p>Full list of changes: <a href=https://github.com/cortexproject/cortex/compare/v0.2.0...v0.3.0>https://github.com/cortexproject/cortex/compare/v0.2.0...v0.3.0</a></p><h2 id=0-2-0-2019-09-05>0.2.0 / 2019-09-05</h2><p>This release has several exciting features, the most notable of them being setting <code>-ingester.spread-flushes</code> to potentially reduce your storage space by upto 50%.</p><ul><li>[CHANGE] Flags changed due to changes upstream in Prometheus Alertmanager <a href=https://github.com/cortexproject/cortex/pull/929>#929</a>:<ul><li><code>alertmanager.mesh.listen-address</code> is now <code>cluster.listen-address</code></li><li><code>alertmanager.mesh.peer.host</code> and <code>alertmanager.mesh.peer.service</code> can be replaced by <code>cluster.peer</code></li><li><code>alertmanager.mesh.hardware-address</code>, <code>alertmanager.mesh.nickname</code>, <code>alertmanager.mesh.password</code>, and <code>alertmanager.mesh.peer.refresh-interval</code> all disappear.</li></ul></li><li>[CHANGE] &ndash;claim-on-rollout flag deprecated; feature is now always on <a href=https://github.com/cortexproject/cortex/pull/1566>#1566</a></li><li>[CHANGE] Retention period must now be a multiple of periodic table duration <a href=https://github.com/cortexproject/cortex/pull/1564>#1564</a></li><li>[CHANGE] The value for the name label for the chunks memcache in all <code>cortex_cache_</code> metrics is now <code>chunksmemcache</code> (before it was <code>memcache</code>) <a href=https://github.com/cortexproject/cortex/pull/1569>#1569</a></li><li>[FEATURE] Makes the ingester flush each timeseries at a specific point in the max-chunk-age cycle with <code>-ingester.spread-flushes</code>. This means multiple replicas of a chunk are very likely to contain the same contents which cuts chunk storage space by up to 66%. <a href=https://github.com/cortexproject/cortex/pull/1578>#1578</a></li><li>[FEATURE] Make minimum number of chunk samples configurable per user <a href=https://github.com/cortexproject/cortex/pull/1620>#1620</a></li><li>[FEATURE] Honor HTTPS for custom S3 URLs <a href=https://github.com/cortexproject/cortex/pull/1603>#1603</a></li><li>[FEATURE] You can now point the query-frontend at a normal Prometheus for parallelisation and caching <a href=https://github.com/cortexproject/cortex/pull/1441>#1441</a></li><li>[FEATURE] You can now specify <code>http_config</code> on alert receivers <a href=https://github.com/cortexproject/cortex/pull/929>#929</a></li><li>[FEATURE] Add option to use jump hashing to load balance requests to memcached <a href=https://github.com/cortexproject/cortex/pull/1554>#1554</a></li><li>[FEATURE] Add status page for HA tracker to distributors <a href=https://github.com/cortexproject/cortex/pull/1546>#1546</a></li><li>[FEATURE] The distributor ring page is now easier to read with alternate rows grayed out <a href=https://github.com/cortexproject/cortex/pull/1621>#1621</a></li></ul><h2 id=0-1-0-2019-08-07>0.1.0 / 2019-08-07</h2><ul><li>[CHANGE] HA Tracker flags were renamed to provide more clarity <a href=https://github.com/cortexproject/cortex/pull/1465>#1465</a><ul><li><code>distributor.accept-ha-labels</code> is now <code>distributor.ha-tracker.enable</code></li><li><code>distributor.accept-ha-samples</code> is now <code>distributor.ha-tracker.enable-for-all-users</code></li><li><code>ha-tracker.replica</code> is now <code>distributor.ha-tracker.replica</code></li><li><code>ha-tracker.cluster</code> is now <code>distributor.ha-tracker.cluster</code></li></ul></li><li>[FEATURE] You can specify &ldquo;heap ballast&rdquo; to reduce Go GC Churn <a href=https://github.com/cortexproject/cortex/pull/1489>#1489</a></li><li>[BUGFIX] HA Tracker no longer always makes a request to Consul/Etcd when a request is not from the active replica <a href=https://github.com/cortexproject/cortex/pull/1516>#1516</a></li><li>[BUGFIX] Queries are now correctly cancelled by the query-frontend <a href=https://github.com/cortexproject/cortex/pull/1508>#1508</a></li></ul><div class="text-muted mt-5 pt-3 border-top"></div></div></main></div></div><footer class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5"><div class="col-12 col-sm-4 pb-5 pb-sm-0"><img src=/images/cortex-stacked-white.png width=75px class="img-fluid float-left"></div><div class="col-12 col-sm-4 pb-5 pb-sm-0"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://slack.cncf.io class="text-reset text-white"><i class="fab fa-fw fa-slack"></i>Slack</a></li><li><a href=https://github.com/cortexproject/cortex class="text-reset text-white"><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a href=https://twitter.com/cortexmetrics class="text-reset text-white"><i class="fab fa-fw fa-twitter"></i>Twitter</a></li></ul></div><div class="col-12 col-sm-4"><h6 class=font-weight-bold>About</h6><p>Cortex is an OSS licensed project as Apache License 2.0</p></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.29b0315468c00226fa6f4556a9cebc0ac4fe1ce1457a01b22c0a06b329877383.js integrity="sha256-KbAxVGjAAib6b0VWqc68CsT&#43;HOFFegGyLAoGsymHc4M=" crossorigin=anonymous></script></body></html>